//@version=6
strategy("Stella's SuperTrend Basic", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=100)

// ============================================
// パラメーター設定（ここを変更してカスタマイズ）
// ============================================
atrPeriod = input.int(10, "ATR期間", minval=1, maxval=100)
multiplier = input.float(3.0, "乗数", minval=0.1, maxval=10.0, step=0.1)

// ============================================
// SuperTrend計算
// ============================================
[supertrend, direction] = ta.supertrend(multiplier, atrPeriod)

// 表示
plot(supertrend, color=direction < 0 ? color.green : color.red, linewidth=2, title="SuperTrend")

// トレンド判定
uptrend = direction < 0
downtrend = direction > 0

// ============================================
// エントリー条件
// ============================================
// ロング: SuperTrendが上向きに転換
longCondition = ta.crossover(close, supertrend) or (uptrend and not uptrend[1])

// ショート: SuperTrendが下向きに転換
shortCondition = ta.crossunder(close, supertrend) or (downtrend and not downtrend[1])

// ============================================
// 売買実行
// ============================================
if longCondition
    strategy.entry("Long", strategy.long)

if shortCondition
    strategy.entry("Short", strategy.short)

// ============================================
// 損切り（オプション）
// ============================================
useStopLoss = input.bool(false, "損切りを使用")
stopLossPercent = input.float(2.0, "損切り幅(%)", minval=0.1, maxval=10.0) / 100

if useStopLoss
    strategy.exit("SL Long", "Long", stop=strategy.position_avg_price * (1 - stopLossPercent))
    strategy.exit("SL Short", "Short", stop=strategy.position_avg_price * (1 + stopLossPercent))

// ============================================
// 背景色表示（オプション）
// ============================================
bgcolor(uptrend ? color.new(color.green, 90) : color.new(color.red, 90))

// ============================================
// シグナルマーカー
// ============================================
plotshape(longCondition, "Long Signal", shape.triangleup, location.belowbar, color.green, size=size.small)
plotshape(shortCondition, "Short Signal", shape.triangledown, location.abovebar, color.red, size=size.small)
